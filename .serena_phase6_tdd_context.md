# Liquid Glass Tech Blog - Phase 6 TDD Implementation Context

## üéØ Current Phase Status: Phase 6 - Blog CMS & Frontend (Phase 6.3-6.8)

**Project Progress**: 32/66 tasks complete (48.5%)  
**Current Phase**: Phase 6 - Blog CMS & Frontend Implementation  
**Phase Status**: Tasks 6.1-6.2 ‚úÖ Complete | Tasks 6.3-6.8 üîÑ Active  
**Focus**: Category/tag pages, theme toggle, responsive design  
**Development Mode**: Test-Driven Development (TDD) with Red-Green-Refactor  

## üìã Phase 6 Remaining Tasks

### Priority 1: Category/Tag Navigation (Tasks 6.3-6.4)
- **6.3**: Category/tag page testing implementation
- **6.4**: Category/tag page implementation with dynamic routing

### Priority 2: Theme System (Tasks 6.5-6.6)  
- **6.5**: Dark/light mode toggle testing with liquid glass integration
- **6.6**: Theme toggle implementation with seasonal theme compatibility

### Priority 3: Responsive Layout (Tasks 6.7-6.8)
- **6.7**: Responsive layout testing across devices
- **6.8**: Mobile-first responsive implementation with touch optimization

## üß™ TDD Environment Configuration for Phase 6

### Testing Framework Setup
```typescript
// Vitest configuration optimized for Phase 6 components
export default defineConfig({
  test: {
    environment: 'jsdom',
    setupFiles: ['./tests/setup.ts'],
    globals: true,
    coverage: {
      provider: 'v8',
      reporter: ['text', 'html', 'lcov'],
      thresholds: {
        lines: 95,
        branches: 90, 
        functions: 95,
        statements: 95
      },
      exclude: [
        'node_modules/**',
        'tests/**',
        '**/*.test.{ts,tsx}',
        '**/*.spec.{ts,tsx}'
      ]
    }
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@/components': path.resolve(__dirname, './src/components'),
      '@/lib': path.resolve(__dirname, './src/lib'),
      '@/types': path.resolve(__dirname, './src/types')
    }
  }
});
```

### Phase 6 Test Structure Requirements
```typescript
// Red-Green-Refactor cycle for Phase 6 components
describe('CategoryPage', () => {
  // Red Phase: Failing test first
  test('should display category articles with liquid glass effects', () => {
    // GIVEN: Category page with articles
    const mockArticles = createMockCategoryArticles('liquid-glass');
    
    // WHEN: Component rendered
    render(<CategoryPage category="liquid-glass" articles={mockArticles} />);
    
    // THEN: Should display articles with glass effects
    expect(screen.getByRole('main')).toBeInTheDocument();
    expect(screen.getAllByTestId('article-card-glass')).toHaveLength(mockArticles.length);
  });
  
  // Green Phase: Minimal implementation
  // Refactor Phase: Enhanced with performance optimization
});
```

## üèóÔ∏è Component Architecture for Phase 6

### Next.js 15 App Router Patterns
```typescript
// Dynamic routing structure for categories and tags
interface CategoryPageProps {
  params: Promise<{ category: string }>;
  searchParams: Promise<{ page?: string; sort?: 'date' | 'popularity' }>;
}

// Server Component pattern for SEO optimization
export default async function CategoryPage({ params, searchParams }: CategoryPageProps) {
  const { category } = await params;
  const { page = '1', sort = 'date' } = await searchParams;
  
  const articles = await getCategoryArticles(category, { page: parseInt(page), sort });
  
  return (
    <CategoryLayout category={category}>
      <ArticleGrid articles={articles} variant="glass-medium" />
      <Pagination currentPage={parseInt(page)} totalPages={articles.totalPages} />
    </CategoryLayout>
  );
}
```

### Liquid Glass Component Integration
```typescript
// Enhanced article cards with liquid glass effects
interface ArticleCardProps {
  article: {
    id: string;
    title: string;
    excerpt: string;
    slug: string;
    eyecatchImage: { url: string; alt: string; blurDataURL: string };
    category: { name: string; slug: string; color: string };
    tags: { name: string; slug: string; color: string }[];
    publishedAt: string;
    readingTime: number;
  };
  variant: 'glass-subtle' | 'glass-medium' | 'glass-intense';
  seasonalTheme?: boolean;
  interactive?: boolean;
  loading?: 'lazy' | 'eager';
}

export const ArticleCard: React.FC<ArticleCardProps> = ({
  article,
  variant = 'glass-medium',
  seasonalTheme = true,
  interactive = true,
  loading = 'lazy'
}) => {
  const { currentTheme } = useSeasonalTheme();
  
  return (
    <LiquidGlassCard
      variant={variant}
      seasonalTheme={seasonalTheme}
      interactive={interactive}
      className="article-card h-full"
      data-testid="article-card-glass"
    >
      <div className="relative overflow-hidden rounded-lg">
        <OptimizedImage
          src={article.eyecatchImage.url}
          alt={article.eyecatchImage.alt}
          blurDataURL={article.eyecatchImage.blurDataURL}
          loading={loading}
          className="aspect-video object-cover"
        />
        <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent" />
        <CategoryBadge 
          category={article.category}
          className="absolute top-3 left-3"
        />
      </div>
      
      <CardContent className="p-6">
        <h3 className="font-bold text-xl mb-2 line-clamp-2">{article.title}</h3>
        <p className="text-muted-foreground mb-4 line-clamp-3">{article.excerpt}</p>
        
        <div className="flex items-center justify-between">
          <TagList tags={article.tags.slice(0, 3)} size="sm" />
          <div className="flex items-center gap-2 text-sm text-muted-foreground">
            <Calendar className="h-4 w-4" />
            <time dateTime={article.publishedAt}>
              {formatDate(article.publishedAt)}
            </time>
            <Clock className="h-4 w-4 ml-2" />
            <span>{article.readingTime}ÂàÜ</span>
          </div>
        </div>
      </CardContent>
    </LiquidGlassCard>
  );
};
```

### Theme Toggle System
```typescript
// Theme toggle with liquid glass integration
interface ThemeToggleProps {
  variant?: 'button' | 'switch' | 'dropdown';
  size?: 'sm' | 'md' | 'lg';
  seasonalIntegration?: boolean;
  accessibilityMode?: boolean;
  position?: 'fixed' | 'relative' | 'sticky';
}

export const ThemeToggle: React.FC<ThemeToggleProps> = ({
  variant = 'button',
  size = 'md',
  seasonalIntegration = true,
  accessibilityMode = true,
  position = 'relative'
}) => {
  const { theme, setTheme } = useTheme();
  const { currentTheme } = useSeasonalTheme();
  const [mounted, setMounted] = useState(false);
  
  useEffect(() => setMounted(true), []);
  
  if (!mounted) return <ThemeSkeleton size={size} />;
  
  const toggleTheme = () => {
    const newTheme = theme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
    
    // Analytics tracking
    trackEvent('theme_toggle', {
      from: theme,
      to: newTheme,
      seasonal_theme: seasonalIntegration ? currentTheme.season : 'none'
    });
  };
  
  return (
    <LiquidGlassCard
      variant="glass-subtle"
      seasonalTheme={seasonalIntegration}
      className={cn(
        'theme-toggle-container',
        position === 'fixed' && 'fixed top-4 right-4 z-50',
        position === 'sticky' && 'sticky top-0 z-40'
      )}
      data-testid="theme-toggle-glass"
    >
      <Button
        onClick={toggleTheme}
        variant="ghost"
        size={size}
        className={cn(
          'theme-toggle-button',
          'transition-all duration-300',
          'hover:scale-110 active:scale-95'
        )}
        aria-label={`Switch to ${theme === 'light' ? 'dark' : 'light'} mode`}
        data-testid="theme-toggle-button"
      >
        <motion.div
          key={theme}
          initial={{ rotate: -90, opacity: 0 }}
          animate={{ rotate: 0, opacity: 1 }}
          exit={{ rotate: 90, opacity: 0 }}
          transition={{ duration: 0.3 }}
        >
          {theme === 'light' ? (
            <Moon className="h-5 w-5" />
          ) : (
            <Sun className="h-5 w-5" />
          )}
        </motion.div>
        
        {accessibilityMode && (
          <span className="sr-only">
            Current theme: {theme}. Click to switch to {theme === 'light' ? 'dark' : 'light'} mode.
          </span>
        )}
      </Button>
    </LiquidGlassCard>
  );
};
```

### Responsive Layout System
```typescript
// Mobile-first responsive layout with liquid glass
interface ResponsiveLayoutProps {
  children: React.ReactNode;
  navigation?: React.ReactNode;
  sidebar?: React.ReactNode;
  glassEffectsEnabled?: boolean;
  performanceMode?: 'auto' | 'high' | 'medium' | 'low';
}

export const ResponsiveLayout: React.FC<ResponsiveLayoutProps> = ({
  children,
  navigation,
  sidebar,
  glassEffectsEnabled = true,
  performanceMode = 'auto'
}) => {
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const { devicePerformance, isMobile, isTablet } = useDeviceDetection();
  const effectsEnabled = glassEffectsEnabled && devicePerformance !== 'low';
  
  return (
    <div 
      className="responsive-layout min-h-screen"
      data-testid="responsive-layout"
      data-performance-tier={devicePerformance}
      data-mobile={isMobile}
      data-tablet={isTablet}
    >
      {/* Mobile Navigation */}
      <MobileNavigation
        isOpen={isMobileMenuOpen}
        onToggle={setIsMobileMenuOpen}
        glassEffects={effectsEnabled}
      />
      
      {/* Desktop/Tablet Layout */}
      <div className="lg:flex lg:min-h-screen">
        {/* Desktop Sidebar */}
        {sidebar && (
          <aside className="hidden lg:block lg:w-64 lg:flex-shrink-0">
            <LiquidGlassCard
              variant={effectsEnabled ? 'glass-subtle' : 'solid'}
              className="sticky top-0 h-screen overflow-y-auto"
            >
              {sidebar}
            </LiquidGlassCard>
          </aside>
        )}
        
        {/* Main Content */}
        <main className="flex-1 lg:overflow-hidden">
          <div className="h-full lg:flex lg:flex-col">
            {/* Header with Navigation */}
            {navigation && (
              <header className="lg:flex-shrink-0">
                <LiquidGlassCard
                  variant={effectsEnabled ? 'glass-medium' : 'solid'}
                  className="backdrop-blur-md border-b"
                >
                  {navigation}
                </LiquidGlassCard>
              </header>
            )}
            
            {/* Content Area */}
            <div className="flex-1 lg:overflow-y-auto">
              <LiquidGlassCard
                variant={effectsEnabled ? 'glass-subtle' : 'solid'}
                className="min-h-full"
              >
                {children}
              </LiquidGlassCard>
            </div>
          </div>
        </main>
      </div>
    </div>
  );
};
```

## üß™ TDD Test Patterns for Phase 6

### Category/Tag Page Testing
```typescript
describe('CategoryPage Component', () => {
  const mockCategory = 'liquid-glass';
  const mockArticles = createMockArticles(6);
  
  beforeEach(() => {
    // Setup seasonal theme mock
    mockUseSeasonalTheme({
      season: 'spring',
      particleEffect: 'sakura'
    });
  });

  test('should render category articles with liquid glass effects', () => {
    // GIVEN: Category page with articles
    render(
      <SeasonalThemeProvider>
        <CategoryPage 
          category={mockCategory}
          articles={mockArticles}
        />
      </SeasonalThemeProvider>
    );
    
    // THEN: Should display category header with glass effects
    expect(screen.getByTestId('category-header-glass')).toBeInTheDocument();
    expect(screen.getByText(`Category: ${mockCategory}`)).toBeInTheDocument();
    
    // THEN: Should display articles as glass cards
    const articleCards = screen.getAllByTestId('article-card-glass');
    expect(articleCards).toHaveLength(mockArticles.length);
    
    // THEN: Each card should have liquid glass styling
    articleCards.forEach(card => {
      expect(card).toHaveStyle({
        backdropFilter: expect.stringContaining('blur')
      });
      expect(card).toHaveAttribute('data-particle-type', 'sakura');
    });
  });

  test('should handle pagination with glass effects maintained', async () => {
    const user = userEvent.setup();
    
    // GIVEN: Category page with pagination
    render(
      <CategoryPage 
        category={mockCategory}
        articles={mockArticles}
        totalPages={3}
        currentPage={1}
      />
    );
    
    // WHEN: User clicks next page
    const nextButton = screen.getByRole('button', { name: /next page/i });
    await user.click(nextButton);
    
    // THEN: Should navigate while maintaining glass effects
    await waitFor(() => {
      expect(screen.getByTestId('pagination-glass')).toBeInTheDocument();
    });
  });

  test('should optimize glass effects for mobile devices', () => {
    // GIVEN: Mobile viewport simulation
    mockUseDeviceDetection({
      isMobile: true,
      devicePerformance: 'medium'
    });
    
    // WHEN: Category page rendered on mobile
    render(<CategoryPage category={mockCategory} articles={mockArticles} />);
    
    // THEN: Should apply mobile-optimized glass effects
    const layout = screen.getByTestId('responsive-layout');
    expect(layout).toHaveAttribute('data-mobile', 'true');
    expect(layout).toHaveAttribute('data-performance-tier', 'medium');
    
    const glassCards = screen.getAllByTestId('article-card-glass');
    glassCards.forEach(card => {
      expect(card).toHaveStyle({
        backdropFilter: 'blur(8px)' // Reduced blur for mobile
      });
    });
  });
});
```

### Theme Toggle Testing
```typescript
describe('ThemeToggle Component', () => {
  test('should toggle themes with liquid glass adaptation', async () => {
    const user = userEvent.setup();
    
    // GIVEN: Theme toggle in light mode
    mockUseTheme({ theme: 'light' });
    
    render(
      <ThemeProvider>
        <ThemeToggle seasonalIntegration />
      </ThemeProvider>
    );
    
    // WHEN: User clicks toggle button
    const toggleButton = screen.getByTestId('theme-toggle-button');
    await user.click(toggleButton);
    
    // THEN: Should switch to dark mode and adapt glass effects
    await waitFor(() => {
      expect(screen.getByTestId('theme-toggle-glass')).toHaveAttribute(
        'data-theme-adapted', 
        'dark'
      );
    });
    
    // THEN: Should animate theme transition
    expect(toggleButton).toHaveClass('transition-all duration-300');
  });

  test('should persist theme preference with seasonal integration', async () => {
    const user = userEvent.setup();
    
    // GIVEN: Theme toggle with seasonal theme
    render(
      <SeasonalThemeProvider>
        <ThemeToggle seasonalIntegration />
      </SeasonalThemeProvider>
    );
    
    // WHEN: User toggles theme
    await user.click(screen.getByTestId('theme-toggle-button'));
    
    // THEN: Should save preference to localStorage
    expect(localStorage.getItem('theme')).toBe('dark');
    expect(localStorage.getItem('seasonal-theme-enabled')).toBe('true');
  });

  test('should be accessible with keyboard navigation', async () => {
    const user = userEvent.setup();
    
    render(<ThemeToggle accessibilityMode />);
    
    // WHEN: User focuses with keyboard
    await user.tab();
    expect(screen.getByTestId('theme-toggle-button')).toHaveFocus();
    
    // WHEN: User presses Enter
    await user.keyboard('{Enter}');
    
    // THEN: Should toggle theme
    await waitFor(() => {
      expect(screen.getByTestId('theme-toggle-glass')).toHaveAttribute(
        'data-theme-adapted',
        'dark'
      );
    });
  });
});
```

### Responsive Layout Testing
```typescript
describe('ResponsiveLayout Component', () => {
  const viewports = [
    { name: 'mobile', width: 375, height: 667 },
    { name: 'tablet', width: 768, height: 1024 },
    { name: 'desktop', width: 1440, height: 900 }
  ];

  viewports.forEach(({ name, width, height }) => {
    test(`should adapt layout and glass effects for ${name}`, () => {
      // GIVEN: Specific viewport
      setViewportSize({ width, height });
      mockUseDeviceDetection({
        isMobile: name === 'mobile',
        isTablet: name === 'tablet',
        devicePerformance: name === 'mobile' ? 'medium' : 'high'
      });
      
      // WHEN: Layout rendered
      render(
        <ResponsiveLayout glassEffectsEnabled>
          <div>Content</div>
        </ResponsiveLayout>
      );
      
      // THEN: Should apply device-appropriate optimizations
      const layout = screen.getByTestId('responsive-layout');
      expect(layout).toHaveAttribute('data-mobile', String(name === 'mobile'));
      expect(layout).toHaveAttribute('data-tablet', String(name === 'tablet'));
      
      if (name === 'mobile') {
        expect(layout).toHaveAttribute('data-performance-tier', 'medium');
        // Should show mobile navigation
        expect(screen.getByTestId('mobile-navigation')).toBeInTheDocument();
      } else {
        expect(layout).toHaveAttribute('data-performance-tier', 'high');
        // Should show desktop layout
        expect(screen.queryByTestId('mobile-navigation')).not.toBeInTheDocument();
      }
    });
  });

  test('should handle orientation change gracefully', () => {
    // GIVEN: Portrait mobile orientation
    setViewportSize({ width: 375, height: 667 });
    
    const { rerender } = render(
      <ResponsiveLayout>
        <div>Content</div>
      </ResponsiveLayout>
    );
    
    // WHEN: Device rotated to landscape
    setViewportSize({ width: 667, height: 375 });
    rerender(
      <ResponsiveLayout>
        <div>Content</div>
      </ResponsiveLayout>
    );
    
    // THEN: Should adapt layout for landscape
    const layout = screen.getByTestId('responsive-layout');
    expect(layout).toHaveClass('orientation-landscape');
  });

  test('should maintain glass effects performance across breakpoints', async () => {
    const performanceMonitor = vi.fn();
    
    // GIVEN: Performance monitoring enabled
    render(
      <ResponsiveLayout 
        glassEffectsEnabled 
        performanceMode="auto"
        onPerformanceUpdate={performanceMonitor}
      >
        <div>Content with effects</div>
      </ResponsiveLayout>
    );
    
    // WHEN: Glass effects are rendered
    await waitFor(() => {
      const glassElements = screen.getAllByTestId(/glass-/);
      expect(glassElements.length).toBeGreaterThan(0);
    });
    
    // THEN: Should maintain target performance
    expect(performanceMonitor).toHaveBeenCalledWith(
      expect.objectContaining({
        fps: expect.any(Number),
        renderTime: expect.any(Number)
      })
    );
  });
});
```

## üìä Performance Testing for Phase 6

### Core Web Vitals Testing
```typescript
// E2E performance testing for liquid glass components
test('Phase 6 components meet Core Web Vitals targets', async ({ page }) => {
  // Navigate to category page
  await page.goto('/categories/liquid-glass');
  
  // Wait for liquid glass effects to load
  await page.waitForLoadState('networkidle');
  await page.waitForSelector('[data-testid="article-card-glass"]');
  
  // Measure Core Web Vitals
  const vitals = await page.evaluate(() => {
    return new Promise((resolve) => {
      const observer = new PerformanceObserver((list) => {
        const entries = list.getEntries();
        const metrics = {};
        
        entries.forEach((entry) => {
          if (entry.entryType === 'largest-contentful-paint') {
            metrics.lcp = entry.startTime;
          }
          if (entry.entryType === 'layout-shift') {
            metrics.cls = entry.value;
          }
        });
        
        resolve(metrics);
      });
      
      observer.observe({ 
        entryTypes: ['largest-contentful-paint', 'layout-shift'] 
      });
    });
  });
  
  // THEN: Should meet Core Web Vitals targets
  expect(vitals.lcp).toBeLessThan(2500); // LCP < 2.5s
  expect(vitals.cls).toBeLessThan(0.1);  // CLS < 0.1
});

// Glass effects performance testing
test('liquid glass effects maintain 60fps', async ({ page }) => {
  await page.goto('/categories/glassmorphism');
  
  // Trigger glass effect animations
  const renderMetrics = await page.evaluate(() => {
    const start = performance.now();
    
    // Animate all glass cards
    document.querySelectorAll('[data-testid="article-card-glass"]').forEach(card => {
      card.style.transform = 'scale(1.05)';
    });
    
    return new Promise((resolve) => {
      requestAnimationFrame(() => {
        resolve(performance.now() - start);
      });
    });
  });
  
  // THEN: Should maintain target frame rate
  expect(renderMetrics).toBeLessThan(16.67); // 60fps threshold
});
```

## üéØ Phase 6 Implementation Priorities

### Immediate Focus (Tasks 6.3-6.4): Category/Tag Pages
1. **Dynamic Routing**: `/categories/[category]/page.tsx` and `/tags/[tag]/page.tsx`
2. **Article Filtering**: Performance-optimized category/tag filtering with pagination
3. **SEO Optimization**: Structured data and meta tags for category pages
4. **Glass Effect Integration**: Category headers and article cards with liquid glass

### Secondary Focus (Tasks 6.5-6.6): Theme System
1. **Theme Toggle Component**: Dark/light mode switching with liquid glass
2. **Seasonal Integration**: Theme combinations with seasonal effects
3. **Persistence**: localStorage and system preference sync
4. **Accessibility**: WCAG 2.1 AA compliance with keyboard navigation

### Final Focus (Tasks 6.7-6.8): Responsive Layout
1. **Mobile Navigation**: Touch-optimized hamburger menu with glass effects
2. **Breakpoint Optimization**: Device-specific glass effect performance
3. **Orientation Support**: Portrait/landscape layout adaptation
4. **Touch Interactions**: Optimized for mobile gesture interactions

## üîÑ Quality Gates for Phase 6

### Entry Gate Requirements
- [ ] Test cases written for all Phase 6.3-6.8 components
- [ ] Mock data and test utilities prepared
- [ ] Performance benchmarks defined (LCP ‚â§2.5s, INP ‚â§200ms, CLS ‚â§0.1)
- [ ] Accessibility test scenarios documented

### Progress Gate Validation
- [ ] Red-Green-Refactor cycle maintained for all implementations
- [ ] Test coverage maintains >95% line coverage
- [ ] Core Web Vitals targets consistently met
- [ ] Glass effects maintain 60fps across devices
- [ ] Mobile responsiveness validated

### Exit Gate Verification  
- [ ] All Phase 6 tests passing with target coverage
- [ ] E2E user journeys validated for category browsing
- [ ] Cross-browser compatibility verified
- [ ] Accessibility compliance confirmed (axe-core + manual testing)
- [ ] Performance benchmarks exceeded
- [ ] Visual regression tests passing

## üöÄ Ready for Phase 6 TDD Implementation

**Serena MCP Context Status**: ‚úÖ **FULLY CONFIGURED**

**TDD Environment**: Ready for strict Red-Green-Refactor implementation of Phase 6 tasks 6.3-6.8 with comprehensive testing coverage for category/tag pages, theme switching, and responsive layout optimization.

**Next Action**: Begin TDD implementation of Task 6.3 - Category/Tag page testing with liquid glass integration and performance optimization.